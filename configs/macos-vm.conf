# macOS Sonoma/Sequoia VM Configuration (Example)
# Requires OpenCore bootloader + macOS installer (see: https://github.com/kholia/OSX-KVM)
# Based on OSX-KVM / Docker-OSX

# ── Identity ──────────────────────────────────────────────────────────────────
VM_NAME="macos-sequoia"
VM_HOSTNAME="mac-mini"
VM_USER="admin"

# ── Machine / Firmware ────────────────────────────────────────────────────────
VM_MACHINE_TYPE="q35"
VM_FIRMWARE="uefi"
# Sonoma/Sequoia: use Haswell-noTSX (Penryn causes kernel panic on Sonoma+)
# Ventura and older: Penryn works fine
VM_CPU_MODEL="Haswell-noTSX,vendor=GenuineIntel,+invtsc,kvm=on,vmware-cpuid-freq=on,+pcid,+ssse3,+sse4.2,+popcnt,+avx,+aes,+xsave,+xsaveopt"
VM_VCPUS="4"
VM_RAM_MB="16384"

# ── Storage ───────────────────────────────────────────────────────────────────
VM_DISK_SIZE_GB="128"
VM_DISK_BUS="virtio"
VM_DISK_CACHE="none"
VM_DISK_FORMAT="qcow2"

# ── ISOs ──────────────────────────────────────────────────────────────────────
# OpenCore bootloader image (from OSX-KVM repo)
VM_ISO_PATH="/var/lib/libvirt/images/OpenCore.qcow2"
# macOS BaseSystem / Recovery / Installer (fetch with OSX-KVM's fetch-macOS-v2.py)
VM_EXTRA_ISO="/var/lib/libvirt/images/BaseSystem.img"

# ── Network ───────────────────────────────────────────────────────────────────
VM_NET_TYPE="network"
VM_NET_SOURCE="default"
VM_NET_MODEL="virtio"
VM_STATIC_IP="192.168.122.160/24"
VM_GATEWAY="192.168.122.1"
VM_DNS="1.1.1.1,8.8.8.8"

# ── Display / Console ─────────────────────────────────────────────────────────
VM_GRAPHICS="vnc"
# vmware-svga gives best resolution control in macOS (set in OpenCore config.plist)
# Alternative: virtio (but may need additional setup)
VM_VIDEO="vmware"

# ── GPU / SR-IOV Passthrough ──────────────────────────────────────────────────
# macOS DOES NOT support Intel iGPU SR-IOV VFs — no drivers exist for Iris Xe
# For GPU acceleration, you MUST use a dedicated AMD GPU (Radeon RX 6600 recommended)
# passed through as a full PCI device (not SR-IOV VF)
# See: https://github.com/kholia/OSX-KVM/blob/master/notes.md
GPU_PASSTHROUGH="no"
GPU_GEN="9"
GPU_PCI_ID=""
GPU_VF_COUNT="2"
GPU_DRIVER="i915"

# ── Cloudflare Tunnel ─────────────────────────────────────────────────────────
VM_TUNNEL_NAME="macos-ssh"
VM_TUNNEL_HOST=""
